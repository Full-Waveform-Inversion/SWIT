# Description of Configuration File (config.yaml) for SWIT v1.1


### **Workflow** (Define the overall workflow)
- **job_workflow** : *list of str*. Define the job workflow, including FORWARD, FWI, RTM, or any combination of them. Possible examples:

    ```yaml
    # For forward modeling job:
    job_workflow: 
        - FORWARD
    ```

    ```yaml
    # For FWI job using the modeled data:
    job_workflow:
        - FORWARD
        - FWI
    ```

    ```yaml
    # For RTM job using the modeled data:
    job_workflow:
        - FORWARD
        - RTM
    ```

    ```yaml
    # For FWI job using the field data (without running the FORWARD job):
    job_workflow:
        - FWI
    ```

    ```yaml
    # For RTM job using the field data (without running the FORWARD job):
    job_workflow:
        - RTM
    ```

    ```yaml
    Note: When using the field data in FWI or RTM, one must manually save the field data as follows:
            path/data/obs/src1/sg.segy
            path/data/obs/src2/sg.segy
            ...
            path/data/obs/srcn/sg.segy
    
    where path is the working directory. Saving the field data manually is identical to run the FORWARD job to generate the modeled data. The field data can be in the SEGY, SU, or binary format.
    ```
- **simu_tag** : *str*. Tag that distinguish the forward simulation, which can be obs, syn, or any other arbitrary tag. Only used for FORWARD job. If not specified, the default value is obs. Example:
    ```yaml
    simu_tag: obs
    ```
- **save_sanp**: *bool*. Save the snapshot or not. Only used for FORWARD job. If not specified, the default value is false. Example:
    ```yaml
    save_snap: true
    ```
### **System** (Define the system parameters)
- **path**: *str*. Working directory. Example:
    ```yaml
    path: /path/to/working/directory/
    ```
- **mpi_cpu_num**: *int*. Maximum number of CPU cores used in MPI for lunching the wavefield solver. Example:
    ```yaml
    mpi_cpu_num: 21
    ```
- **max_cpu_num**: *int*. Maximum number of CPU cores available on the machine. Example:
    ```yaml
    max_cpu_num: 40
    ```
- **fig_aspect**: *float*. Aspect ratio of the figure. Sometimes, it is useful to adjust the aspect ratio of the figure. Example:
    ```yaml
    fig_aspect:  1.0
    ```
### **Model** (Define the model parameters)
- **nx**: *int*. Number of grid points in x direction. Example:
    ```yaml
    nx: 481
    ```
- **nz**: *int*. Number of grid points in z direction. Example:
    ```yaml
    nz: 121
    ```
- **dx**: *float*. Grid spacing in x and z directions (in meter). Example:
    ```yaml
    dx: 25.0
    ```
- **nt**: *int*. Number of time steps. Example:
    ```yaml
    nt: 4001
    ```
- **dt**: *float*. Time step (in second). Example:
    ```yaml
    dt: 0.002
    ```
- **pml**: *int*. Number of PML grid points on each side. Set a large number because the PML performs not so well. Example:
    ```yaml
    pml: 40
    ```
- **vp_file**: *str*. Path to the true velocity file that can be a *npy, *bin, *dat, or *txt file. The true velocity model is a 2-D array with shape (nx, nz) in m/s, and is only used for FORWARD job for calculating the obs data. Example:
    ```yaml
    vp_file: /path/to/vp_true.npy
    ```
- **rho_file**: *str*. Path to the true density file that can be a *npy, *bin, *dat, or *txt file. The true density model is a 2-D array with shape (nx, nz) in kg/m^3 and is only used for FORWARD job for calculating the obs data. Example:
    ```yaml
    rho_file: /path/to/rho_true.npy
    ```
### **Receiver** (Define the receiver parameters)
- **rec_comp**: *str*. Receiver component that can be vz, vx, or p. For the land acquisition, vz (vertical geophone) is often used. For the marine acquisition, p (hydrophone) is often used. Example:
    ```yaml
    rec_comp: vz
    ```
- **rec_coord_file**: *str*. Path to the receiver coordinate file in the ***npz** format. This file contains a list of 2D arrays with shape (nrec, 2), each of which is the coordinate file for one shot and can be different from each other. The first and the seconnd columns are the x and z coordinates of the receiver in meter, respectively. The receiver coordinate file is used for FORWARD, FWI, and RTM jobs. Example:
    ```yaml
    rec_coord_file: /path/to/rec_coord.npz
    ```

### **Source** (Define the source parameters)

- **amp0**: *float*. Source amplitude. Example:
    ```yaml
    amp0: 1.0
    ```
- **f0**: *float*. Source frequency (in Hz). Example:
    ```yaml
    f0: 5.0
    ```

- **src_type**: *str*. Source type that can be file or ricker. If src_type is set as file, the source wavelet is read from the file specified by wavelet_file below. If src_type is ricker, the source wavelet is generated by the Ricker wavelet with the amplitude and dominant frequency specified by amp0 and f0 above. Example:
    ```yaml
    src_type: ricker
- **src_coord_file**: *str*. Path to the source coordinate file in the ***npy** format. The source coordinate is a 2-D array with shape (nsrc, 2), where nsrc is the number of sources. The first and the seconnd columns are the x and z coordinates of the receiver in meter, respectively. The source coordinate file is used for FORWARD, FWI, and RTM jobs. Example:
    ```yaml
    src_coord_file: /path/to/src_coord.npy
    ```
- **wavelet_file**: *str*. Path to the source wavelet file in the ***npy** format. The source wavelet is a 2-D array with shape (nsrc, nt), where nsrc is the number of sources and nt is the number of time steps (must be the same as nt in the Model section). The source wavelet file is used for FORWARD, FWI, and RTM jobs. Example:
    ```yaml
    wavelet_file: /path/to/wavelets.npy
    ```

### **Optimizer** ( Define the optimizer in FWI)
- **vp_init_file**: *str*. Path to the initial velocity model file that can be a *npy, *bin, *dat, or *txt file. The initial velocity model is a 2-D array with shape (nx, nz) in m/s. The initial velocity model file is used for FWI or RTM job. Example:
    ```yaml
    vp_init_file: /path/to/vp_init.npy
    ```
- **rho_init_file**: *str*. Path to the initial density model file that can be a *npy, *bin, *dat, or *txt file. The initial density model is a 2-D array with shape (nx, nz) in kg/m^3. The initial density model file is used for FWI or RTM job. Example:
    ```yaml
    rho_init_file: /path/to/rho_init.npy
    ```
- **grad_mask_file**: *str*. Path to the gradient mask file that can be a *npy, *bin, *dat, or *txt file. The gradient mask is a 2-D array with shape (nx, nz) with value 1 or 0. If the value is 0, the gradient in corresponding grid point is set to zero and thus does not contribute to update of the velocity model. If left as empty, default gradient damping masking is applied, which is useful for land acquisition. Example:
    ```yaml
    # For marine acquisition, provide a gradient mask file to mask out the gradient in the water layer
    grad_mask_file: /path/to/grad_mask.npy
    ```
    ```yaml
    # For land acquisition, please leave the grad_mask_file as empty and use the default gradient damping masking
    grad_mask_file:
    ```
- **misfit_type**: *str*. Misfit type that can be waveform, envelope, traveltime, or globalcorrelation. Example:
    ```yaml
    misfit_type: waveform
    ```
- **method**: *str*. Optimization method that can be SD, CG, BFGS, PLBFGS, TRN, or PTRN. They correspond to the Steepest Descent, Conjugate Gradient, L-BFGS, Preconditioned L-BFGS, Truncated Newton, and Preconditioned Truncated Newton methods, respectively. Example:
    ```yaml
    method: CG
    ```
- **niter_max**: *int*. Maximum number of iterations. Example:
    ```yaml
    niter_max: 10
    ```
- **bound**: *bool*. Whether to apply bound constraint on the velocity model. Example:
    ```yaml
    bound: true
    ```
- **vp_min**: *float*. Minimum velocity bound constrain in m/s. Only useful when bound is set as true. Example:
    ```yaml
    vp_min: 1000
    ```
- **vp_max**: *float*. Maximum velocity bound constrain in m/s. Only useful when bound is set as true. Example:
    ```yaml
    vp_max: 6000
    ```
- **grad_smooth_size**: *int*. Size of the Gaussian smoothing window applied on the gradient before updating the velocity model. If set as 0, no smoothing is applied. Example:
    ```yaml
    grad_smooth_size: 5
    ```
- **update_vpmax**: *float*. Maximum update of the velocity model in m/s used to control the step size of the velocity model update in first iteration. The step size is then adjusted automatically in the following iterations. Example:
    ```yaml
    update_vpmax: 50
    ```
- **debug**: *bool*. Whether to output the iteration information. Example:
    ```yaml
    debug: false
    ```
### **Preprocessor** ( Define the data preprocessor for FWI and/or RTM)
- **filer**: *str*. Filter type that can be none, bandpass, lowpass, or highpass. Example:
    ```yaml
    filer: bandpass
    ```
- **filter_high**: *float*. High frequency of the bandpass filter in Hz. When the filter is set as bandpass, keep the data in (filter_low, filter_high). If the filter is set as highpass, keep the data in (filter_high, inf). Example:
    ```yaml
    filter_high: 10.0
    ```
- **filter_low**: *float*. Low frequency of the bandpass filter in Hz.  When the filter is set as bandpass, keep the data in (filter_low, filter_high). If the filter is set as lowpass, keep the data in (0, filter_low). Example:
    ```yaml
    filter_low: 5.0
    ```
- **mute_near_offset**: *bool*. Whether to mute the near offset data. Example:
    ```yaml
    mute_near_offset: false
    ```
- **mute_near_distance**: *float*. Distance of the near offset mute in meter. Only useful when mute_near_offset is set as true. Example:
    ```yaml
    mute_near_distance: 500
    ```
- **mute_far_offset**: *bool*. Whether to mute the far offset data. Example:
    ```yaml
    mute_far_offset: false
    ```
- **mute_far_distance**: *float*. Distance of the far offset mute in meter. Only useful when mute_far_offset is set as true. Example:
    ```yaml
    mute_far_distance: 8000
    ```
- **mute_late_arrival**: *bool*. Whether to mute the late arrival data and only keep the early arrival data. Example:
    ```yaml
    mute_late_arrival: false
    ```
- **mute_late_size**: *float*. Size of the late arrival mute in second. Only useful when mute_late_arrival is set as true. Example:
    ```yaml
    mute_late_size: 0.5
    ```
- **normalize_data**: *bool*. Whether to normalize the data. Example:
    ```yaml
    normalize_data: false
    ```
